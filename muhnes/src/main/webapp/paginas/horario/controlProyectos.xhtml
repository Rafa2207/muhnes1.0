<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template.xhtml">
        <ui:define name="title">
            <h:outputText value="Calendarización"></h:outputText>
        </ui:define>

        <ui:define name="body">

            <h:form id="ControlForm" >
                <p:panel header="Control del proyecto: #{controladorSesion.proyecto.MNombre}">

                    <p:breadCrumb>
                        <p:menuitem value="casita"/>
                        <p:menuitem value="Seleccione proyecto" outcome="/paginas/horario/Agenda.xhtml" />
                        <p:menuitem value="Control de proyecto" outcome="/paginas/horario/controlProyectos.xhtml" />
                    </p:breadCrumb>
                    <br></br>

                    <p:schedule id="agendaId" locale="es" widgetVar="AgendaProyecto"
                                value="#{controlProyectos.eventModel}"
                                aspectRatio="3" draggable="false" rightHeaderTemplate="" showWeekends="false" 
                                tooltip="true" resizable="false" initialDate="#{controladorSesion.proyecto.FFechaInicio}"
                                timeZone="GMT-6">  
                        <p:ajax event="eventSelect" listener="#{controlProyectos.seleccionEvento}"  update=":modales" oncomplete="PF('dialogVer').show();" />
                    </p:schedule>
                </p:panel>
            </h:form>

            <h:form id="modales">
                <p:dialog widgetVar="dialogVer" header="Visualizar" showEffect="clip" hideEffect="clip">

                    <!-- Para Actividades no iniciadas  -->
                    <h:panelGroup id="NoIniciado"  rendered="#{controlProyectos.comparador eq 'No iniciado'}" >
                        <p:panelGrid columns="2" id="iniciar" style="width: 450px">

                            <h:outputText value="Nombre:"/>
                            <h:outputText value="#{controlProyectos.actividadView.MNombre}"/>

                            <h:outputText value="Presupuesto:"/>
                            <h:outputText value="#{controlProyectos.actividadView.DTotal}">
                                <f:convertNumber type="number" groupingUsed="true" minFractionDigits="2" pattern="$#0.00"/>
                            </h:outputText>

                            <h:outputText value="Fecha espectativa de inicio:"/>
                            <h:outputText value="#{controlProyectos.actividadView.FFecha}">
                                <f:convertDateTime pattern="dd MMMM yyyy" />
                            </h:outputText>

                            <h:outputText value="Fecha espectativa de Finalización:"/>
                            <h:outputText value="#{controlProyectos.actividadView.FFechafin}">
                                <f:convertDateTime pattern="dd MMMM yyyy" />
                            </h:outputText>

                        </p:panelGrid>
                        <p:commandButton actionListener="#{controlProyectos.iniciarActividad()}" update="iniciar :ControlForm:agendaId  :growl" value="Iniciar actividad" oncomplete="handleSubmit(args, 'dialogVer');" >
                            <p:confirm header="Confirmación" message="¿Está seguro que desea iniciar actividad?" icon="ui-icon-alert" />
                        </p:commandButton>
                    </h:panelGroup>

                    <!-- Para actividades en proceso  -->
                    <h:panelGroup id="EnProceso"  rendered="#{controlProyectos.comparador eq 'En proceso'}" >
                        <p:panelGrid columns="2" id="Proceso" style="width: 450px">
                            
                            <h:outputText value="Nombre:"/>
                            <h:outputText value="#{controlProyectos.actividadView.MNombre}"/>
                            
                            <h:outputText value="Nombre:"/>
                            
                            


                            <p:commandButton update="Proceso :ControlForm:agendaId  :growl" value="Finalizar actividad" oncomplete="handleSubmit(args, 'dialogVer');" >
                                <p:confirm header="Confirmación" message="¿Está seguro que desea finalizar actividad?" icon="ui-icon-alert" />
                            </p:commandButton>
                        </p:panelGrid>
                    </h:panelGroup>
                </p:dialog>    
            </h:form>


        </ui:define>
    </ui:composition>

</html>
